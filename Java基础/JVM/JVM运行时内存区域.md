# 运行时内存区域
（此文为深入理解Java虚拟机的笔记，在此基础上有所拓展）
Java虚拟机在执行Java程序的过程中会把它所管理的内存划分为若干个不同的数据区域。
jvm运行时内存区域主要包括：程序计数器，虚拟机栈，本地方法栈，堆，方法区，运行时常量池，直接内存

在Java线程中有俩类线程，用户线程和守护线程；用户线程就是在我们创建线程时的默认的一类线程，它允许在前台，例如我们执行main方法的时候，JVM会启动一个main线程，这个main线程就是用户线程；
而守护线程就是运行在后台的线程，它服务于用户线程，例如GC时的GC内存回收线程。JVM与用户线程共存亡，只要有用户线程JVM就不会停止执行，当只剩下守护线程时，JVM才会停止执行

祭出这张经典到不能再经典的图了
![](https://raw.githubusercontent.com/409582940/notes/main/images/20211210164805.png)
## 程序计数器
程序计数器是一块较小的内存空间，它可以当作当前线程所执行的字节码行号指示器。字节码解释器的工作就是改变这个计数器的值来选取下一条需要执行的字节码指令
程序控制流的指示器，分支，循环，跳转，异常处理，线程恢复等基础功能都需要依赖这个程序计数器来实现
程序计数器是线程私有的原因：Java的多线程是通过线程轮流切换，分配处理器的时间片实现的。在任何一个已经确定的时刻，都会只执行一个线程的指令（多线程处理器则为一个内核）
所以，为了能够在线程切换后能恢复到正确的执行位置，每个线程都需要一个独立的程序计数器。彼此之间相互独立。
如果执行的是Java方法，记录的是正在执行的虚拟机字节码指令的地址，如果执行的是本地方法，则为空。这是唯一一个没有规定任何OutOfMemoryError的区域。

在CPU中。程序计数器的含义是寄存器，存放下一条指令所在单元的地址和地方

## 虚拟机栈

虚拟机栈跟程序计数器一样，都是线程私有的区域。每一个Java被执行的时候，JVM都会创建一个栈帧，用于存储局部变量表，操作数栈，动态链接，方法出口等信息
每一个方法从被调用到被执行完毕，都对应着一个栈在虚拟机栈从入栈到出栈的过程

局部变量表存储着编译时的基本数据类型（byte，long......），对象引用，ruturnAddress（指向一条字节码指令的地址）。这些变量在局部变量表中的存储空间以局部变量槽来表示。long和double使用两个变量槽，其他使用一个
局部变量表所需要的内存空间在编译期间分配，当进入一个方法时，这个方法需要的局部变量空间是确定的（变量槽的数量）


